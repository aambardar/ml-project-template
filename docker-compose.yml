# Docker Compose for ML Development
# ==================================
# Usage:
#   docker compose up -d          # Start container in background
#   docker compose exec dev bash  # Open shell in container
#   docker compose down           # Stop container

services:
  dev:
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: ml-base:latest
    container_name: ml-dev

    # Mount project directory for live code changes
    # [HOST PATH] : [CONTAINER PATH]
    # Mount the left side On the right side location.
    volumes:
      # Project code - synced via PyCharm
      - ${DOCKER_VM_PROJECT_BASE_PATH:-.}/${PROJECT_NAME:-ml-default}:/app

      # Data - large files, NOT synced (stays on VM)
      - ${DOCKER_VM_DATA_BASE_PATH:-./data}/${PROJECT_NAME:-ml-default}:/data
      # Models - trained model artifacts
      - ${DOCKER_VM_MODELS_BASE_PATH:-./models}/${PROJECT_NAME:-ml-default}:/models

      # Outputs - logs, figures, checkpoints
      - ${DOCKER_VM_OUTPUTS_BASE_PATH:-./outputs}/${PROJECT_NAME:-ml-default}:/outputs

      # Jupyter settings persistence
      - jupyter-data:/root/.jupyter

    # Load environment variables
    env_file:
      - .env

    # Expose common ML service ports
    ports:
      - "8888:8888"   # JupyterLab
      - "8000:8000"   # FastAPI / Model serving
      - "6006:6006"   # TensorBoard
      - "5000:5000"   # MLflow

    # Keep container running for interactive use
    stdin_open: true
    tty: true

    # Restart policy
    restart: unless-stopped

    # Working directory
    working_dir: /app

volumes:
  jupyter-data:
